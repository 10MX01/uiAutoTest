## Why

当前测试自动化脚本编写面临两大痛点：(1) **元素定位脆弱性** - 传统方案依赖手动猜测选择器，页面结构变化导致脚本频繁失效；(2) **编写效率低下** - 测试人员需要手动编写结构化步骤，学习成本高、维护困难。

随着AI大语言模型技术的成熟，结合Playwright的页面快照能力，我们可以实现智能化的脚本生成方案：通过AI分析实际页面结构自动生成最优选择器，并将自然语言测试步骤转换为可执行的脚本代码。这将大幅提升测试用例的创建效率和维护稳定性。

本变更分两个阶段实施：第一阶段实现AI服务统一接入能力，第二阶段基于接入的AI服务实现智能脚本生成功能。

## What Changes

本变更分两个阶段实施，将AI驱动的测试脚本生成能力引入系统：

### 阶段一：AI服务统一接入（ai-service-integration）

- **AI模型配置管理**
  - 提供管理页面界面用于配置AI服务接入信息
  - 支持多家AI服务提供商：OpenAI、Claude、通义千问、文心一言等
  - **支持自定义HTTP端点接入**：用户可配置自己的AI服务代理或兼容OpenAI格式的服务（企业网关、私有化模型等）
  - 配置项仅包含：服务提供商、API密钥（可选）、模型名称、API端点（可选）、自定义请求头（可选）
  - **不做token管理、流量控制、成本统计等额外功能**

- **多种接入方式**
  - **直接接入**：配置第三方AI服务的API Key，系统直接调用
  - **自定义端点接入**：配置HTTP端点URL，系统按OpenAI兼容格式调用，用户自行处理认证和转发
  - 适用于企业内部AI服务网关、私有化部署模型、自建AI服务等场景

- **连接性验证**
  - 配置保存后自动发送测试请求验证API可用性
  - 支持手动触发连接测试
  - 状态标识：可用、不可用、未测试

- **AI服务抽象层**
  - 统一的LLM服务接口，屏蔽不同AI服务商的差异
  - 支持运行时动态切换AI服务（无需重启系统）
  - 基础的文本生成接口：发送文本Prompt，返回文本响应

### 阶段二：智能脚本生成（ai-script-generation）

基于阶段一接入的AI服务，实现核心的智能脚本生成功能：

- **自然语言测试步骤解析**
  - 用户使用自然语言描述测试步骤（如："打开登录页面，输入用户名admin，点击登录按钮"）
  - AI自动将自然语言转换为结构化的测试步骤JSON
  - 转换结果包括：操作类型（navigate/click/fill等）、目标选择器、参数值
  - 用户可查看并手动编辑转换结果

- **智能页面分析与脚本生成**
  - 请求时捕获指定页面快照，提取所有可交互元素的属性信息
  - 基于页面快照和自然语言意图，AI自动生成最优选择器的测试步骤
  - 选择器优先级策略：data-testid > id > name > aria-label > text > CSS > XPath
  - 为每个步骤生成备用选择器，提高脚本鲁棒性
  - 返回完整的生成结果（步骤列表、页面快照信息、选择器元数据）

**注意**：本模块专注于AI转化能力（自然语言→JSON，页面快照+自然语言→脚本），不涉及脚本的生命周期管理（存储、缓存、版本控制等由调用方负责）。

## Capabilities

### New Capabilities

- **ai-service-integration**: AI服务统一接入与管理能力，支持多家AI服务商（OpenAI/Claude/通义千问/文心一言）的配置、连接性验证和统一调用接口。通过管理页面进行配置，仅负责接入和验证可用性，不做token/流量管理。

- **ai-script-generation**: 基于AI服务的智能脚本生成能力，专注于将自然语言测试步骤和页面快照转换为结构化的测试脚本，包括自然语言解析、页面元素分析、智能选择器生成等核心转化能力。

### Modified Capabilities

无需修改现有能力的需求。本变更为测试用例执行增强功能，不改变现有API的行为契约。

## Impact

**新增组件**：
- 阶段一（ai-service-integration）：
  - `LLMService` 接口及实现类（OpenAI、Claude、通义千问、文心一言、自定义端点）
  - `AIConfigController` - AI服务配置管理API
  - `AIConfigService` - AI服务配置业务逻辑
  - `AIConfigEntity` - AI服务配置实体
  - `ai_service_configs` 表 - AI服务配置存储

- 阶段二（ai-script-generation）：
  - `PageSnapshotService` - 页面快照捕获与元素提取服务
  - `ScriptGenerationService` - AI脚本生成协调服务
  - `NaturalLanguageParser` - 自然语言解析服务
  - `AIScriptController` - AI脚本生成API控制器

**修改组件**：
- `TestCaseService` - 集成自然语言解析功能，支持自动填充结构化步骤

**外部依赖**：
- OpenAI SDK、Anthropic SDK、阿里云SDK等（根据用户配置选择）
- 用户需要自行申请AI服务的API Key或配置自定义端点

**数据存储**：
- 阶段一：`ai_service_configs` 表
- 阶段二：无需持久化存储（仅返回生成结果，存储由调用方负责）

**性能影响**：
- 自然语言解析：需要调用AI服务（预计1-3秒）
- 页面快照捕获：需要Playwright导航和元素提取（预计2-3秒）
- 脚本生成：页面快照+AI调用（预计3-5秒）

**用户影响**：
- 测试用例创建流程更简单，支持自然语言输入
- 支持基于页面快照智能生成脚本
- 管理员需通过管理页面配置AI服务
- 对普通用户完全屏蔽AI服务细节
